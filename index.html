<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tra c·ª©u Danh m·ª•c Ngh·ªÅ nghi·ªáp Vi·ªát Nam</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px; 
        }
        .container { 
            max-width: 1400px; 
            background: white; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.2); 
        }
        .level-1-row { 
            background-color: #d1e7dd; 
            font-weight: bold; 
            font-size: 1.05rem;
        }
        .level-2-row { 
            background-color: #cfe2ff; 
            font-weight: bold; 
            font-size: 0.98rem;
        }
        .level-3-row { 
            background-color: #f8f9fa; 
        }
        #dataTable { 
            font-size: 0.9rem; 
        }
        .highlight { 
            background-color: #fff3cd; 
            padding: 2px 4px;
            border-radius: 3px;
        }
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .stats-number {
            font-size: 2rem;
            font-weight: bold;
        }
        .loading {
            text-align: center;
            padding: 40px;
        }
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        th {
            position: sticky;
            top: 0;
            background-color: #212529 !important;
            z-index: 10;
        }
        .table-container {
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }
        .badge-custom {
            font-size: 0.85rem;
            padding: 5px 10px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="text-center mb-4">
        <h1 class="text-primary">üîç Tra c·ª©u Danh m·ª•c Ngh·ªÅ nghi·ªáp Vi·ªát Nam</h1>
        <p class="text-muted">H·ªá th·ªëng ph√¢n lo·∫°i ngh·ªÅ nghi·ªáp theo 5 c·∫•p ƒë·ªô</p>
    </div>

    <div id="loading" class="loading">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">ƒêang t·∫£i d·ªØ li·ªáu...</span>
        </div>
        <p class="mt-3 text-muted">ƒêang t·∫£i d·ªØ li·ªáu ngh·ªÅ nghi·ªáp...</p>
    </div>

    <div id="mainContent" style="display:none;">
        <!-- Th·ªëng k√™ -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number" id="totalRecords">0</div>
                    <div>T·ªïng s·ªë ngh·ªÅ</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number" id="level1Count">0</div>
                    <div>Ng√†nh C·∫•p 1</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number" id="level2Count">0</div>
                    <div>Ng√†nh C·∫•p 2</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number" id="displayCount">0</div>
                    <div>ƒêang hi·ªÉn th·ªã</div>
                </div>
            </div>
        </div>

        <!-- B·ªô l·ªçc -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">üéØ B·ªô l·ªçc t√¨m ki·∫øm</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="level2Select" class="form-label fw-bold">
                            <i class="bi bi-funnel"></i> Ch·ªçn Ng√†nh C·∫•p 2
                        </label>
                        <select class="form-select form-select-lg" id="level2Select" onchange="filterTable()">
                            <option value="all">üìã Hi·ªÉn th·ªã t·∫•t c·∫£ c√°c ng√†nh</option>
                        </select>
                        <small class="text-muted">Ch·ªçn m·ªôt ng√†nh c·∫•p 2 ƒë·ªÉ xem chi ti·∫øt c√°c ngh·ªÅ nghi·ªáp thu·ªôc ng√†nh ƒë√≥</small>
                    </div>
                    <div class="col-md-6">
                        <label for="searchInput" class="form-label fw-bold">
                            <i class="bi bi-search"></i> T√¨m ki·∫øm t·ª´ kh√≥a
                        </label>
                        <input type="text" class="form-control form-control-lg" id="searchInput" 
                               placeholder="Nh·∫≠p t√™n ngh·ªÅ (vd: B√°c sƒ©, K·ªπ s∆∞, Gi√°o vi√™n...)" 
                               onkeyup="filterTable()">
                        <small class="text-muted">T√¨m ki·∫øm trong t√™n ngh·ªÅ nghi·ªáp</small>
                    </div>
                </div>
                <div class="mt-3">
                    <button class="btn btn-outline-secondary" onclick="resetFilter()">
                        üîÑ ƒê·∫∑t l·∫°i b·ªô l·ªçc
                    </button>
                    <button class="btn btn-outline-primary" onclick="exportToCSV()">
                        üì• Xu·∫•t CSV
                    </button>
                </div>
            </div>
        </div>

        <!-- B·∫£ng d·ªØ li·ªáu -->
        <div class="table-container">
            <table class="table table-bordered table-hover mb-0" id="dataTable">
                <thead class="table-dark">
                    <tr>
                        <th style="width: 6%">C·∫•p 1</th>
                        <th style="width: 6%">C·∫•p 2</th>
                        <th style="width: 6%">C·∫•p 3</th>
                        <th style="width: 6%">C·∫•p 4</th>
                        <th style="width: 6%">C·∫•p 5</th>
                        <th style="width: 70%">T√™n g·ªçi ngh·ªÅ nghi·ªáp</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>
        
        <div class="mt-3 d-flex justify-content-between align-items-center">
            <div id="recordCount" class="text-muted"></div>
            <div>
                <span class="badge bg-success badge-custom">C·∫•p 1 - Ng√†nh ch√≠nh</span>
                <span class="badge bg-info badge-custom">C·∫•p 2 - Ph√¢n nh√≥m</span>
                <span class="badge bg-light text-dark badge-custom">C·∫•p 3-5 - Chi ti·∫øt</span>
            </div>
        </div>
    </div>
</div>

<script>
    let parsedData = [];
    let level2Map = new Map(); // Map ƒë·ªÉ l∆∞u th√¥ng tin C·∫•p 2
    let allData = {
        level1Count: 0,
        level2Count: 0,
        totalRecords: 0
    };

    // T·ª± ƒë·ªông t·∫£i d·ªØ li·ªáu khi trang load
    window.onload = function() {
        loadDataFromFile();
    };

    // H√†m t·∫£i d·ªØ li·ªáu t·ª´ file data.txt
    async function loadDataFromFile() {
        try {
            const response = await fetch('data.txt');
            if (!response.ok) {
                throw new Error('Kh√¥ng th·ªÉ t·∫£i file data.txt');
            }
            
            const text = await response.text();
            processData(text);
            
        } catch (error) {
            document.getElementById('loading').innerHTML = `
                <div class="alert alert-danger">
                    <h4>‚ùå L·ªói t·∫£i d·ªØ li·ªáu</h4>
                    <p>${error.message}</p>
                    <p class="mb-0">Vui l√≤ng ƒë·∫£m b·∫£o file <strong>data.txt</strong> n·∫±m c√πng th∆∞ m·ª•c v·ªõi file HTML n√†y.</p>
                </div>
            `;
        }
    }

    // H√†m x·ª≠ l√Ω d·ªØ li·ªáu
    function processData(rawText) {
        const lines = rawText.split('\n');
        parsedData = [];
        level2Map.clear();
        
        let currentLevel1 = null;
        let currentLevel2 = null;

        // B·ªè qua d√≤ng ti√™u ƒë·ªÅ
        for (let i = 1; i < lines.length; i++) {
            const line = lines[i].trim();
            if (!line) continue;

            const cols = line.split('\t');
            
            const c1 = cols[0] ? cols[0].trim() : "";
            const c2 = cols[1] ? cols[1].trim() : "";
            const c3 = cols[2] ? cols[2].trim() : "";
            const c4 = cols[3] ? cols[3].trim() : "";
            const c5 = cols[4] ? cols[4].trim() : "";
            const name = cols[5] ? cols[5].trim() : "";

            // C·∫≠p nh·∫≠t context
            if (c1) {
                currentLevel1 = c1;
                currentLevel2 = null;
                allData.level1Count++;
            }
            if (c2) {
                currentLevel2 = c2;
                // L∆∞u th√¥ng tin C·∫•p 2 v√†o Map
                if (!level2Map.has(c2)) {
                    level2Map.set(c2, {
                        code: c2,
                        name: name,
                        level1: currentLevel1
                    });
                    allData.level2Count++;
                }
            }

            const row = {
                c1, c2, c3, c4, c5, name,
                level1Context: currentLevel1,
                level2Context: currentLevel2,
                isLevel1: c1 && !c2,
                isLevel2: c2 && !c3,
                isLevel3: c3 && !c4,
                isLevel4: c4 && !c5,
                isLevel5: c5 ? true : false
            };

            parsedData.push(row);
            allData.totalRecords++;
        }

        populateLevel2Select();
        updateStats();
        showMainContent();
        filterTable();
    }

    // Hi·ªÉn th·ªã n·ªôi dung ch√≠nh
    function showMainContent() {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
    }

    // C·∫≠p nh·∫≠t th·ªëng k√™
    function updateStats() {
        document.getElementById('totalRecords').textContent = allData.totalRecords;
        document.getElementById('level1Count').textContent = allData.level1Count;
        document.getElementById('level2Count').textContent = allData.level2Count;
    }

    // ƒê·ªï d·ªØ li·ªáu v√†o dropdown C·∫•p 2
    function populateLevel2Select() {
        const select = document.getElementById('level2Select');
        select.innerHTML = '<option value="all">üìã Hi·ªÉn th·ªã t·∫•t c·∫£ c√°c ng√†nh</option>';
        
        // Chuy·ªÉn Map th√†nh Array v√† s·∫Øp x·∫øp theo m√£
        const sortedList = Array.from(level2Map.values()).sort((a, b) => {
            return parseInt(a.code) - parseInt(b.code);
        });

        sortedList.forEach(item => {
            const option = document.createElement('option');
            option.value = item.code;
            option.text = `${item.code} - ${item.name}`;
            select.appendChild(option);
        });
    }

    // H√†m l·ªçc v√† hi·ªÉn th·ªã b·∫£ng
    function filterTable() {
        const selectedL2 = document.getElementById('level2Select').value;
        const keyword = document.getElementById('searchInput').value.toLowerCase().trim();
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';

        let displayCount = 0;
        let shouldIncludeRow = false;
        let currentL2Context = null;

        parsedData.forEach(row => {
            // C·∫≠p nh·∫≠t context C·∫•p 2
            if (row.c2) {
                currentL2Context = row.c2;
            } else if (row.c1) {
                currentL2Context = null;
            }

            // Logic l·ªçc theo C·∫•p 2
            let matchLevel2 = false;
            if (selectedL2 === 'all') {
                matchLevel2 = true;
            } else {
                // Hi·ªÉn th·ªã d√≤ng n·∫øu:
                // 1. L√† d√≤ng C·∫•p 1 ch·ª©a C·∫•p 2 ƒë∆∞·ª£c ch·ªçn
                if (row.isLevel1) {
                    // Ki·ªÉm tra xem C·∫•p 1 n√†y c√≥ ch·ª©a C·∫•p 2 ƒë∆∞·ª£c ch·ªçn kh√¥ng
                    const hasSelectedL2 = parsedData.some(r => 
                        r.level1Context === row.c1 && r.c2 === selectedL2
                    );
                    matchLevel2 = hasSelectedL2;
                }
                // 2. L√† ch√≠nh d√≤ng C·∫•p 2 ƒë∆∞·ª£c ch·ªçn
                else if (row.c2 === selectedL2) {
                    matchLevel2 = true;
                }
                // 3. Thu·ªôc v·ªÅ C·∫•p 2 ƒë∆∞·ª£c ch·ªçn
                else if (currentL2Context === selectedL2) {
                    matchLevel2 = true;
                }
            }

            // Logic t√¨m ki·∫øm t·ª´ kh√≥a
            let matchKeyword = true;
            if (keyword) {
                matchKeyword = row.name.toLowerCase().includes(keyword) ||
                              row.c1.includes(keyword) ||
                              row.c2.includes(keyword) ||
                              row.c3.includes(keyword) ||
                              row.c4.includes(keyword) ||
                              row.c5.includes(keyword);
            }

            // Hi·ªÉn th·ªã d√≤ng n·∫øu th·ªèa m√£n c·∫£ 2 ƒëi·ªÅu ki·ªán
            if (matchLevel2 && matchKeyword) {
                const tr = document.createElement('tr');
                
                // √Åp d·ª•ng class theo c·∫•p
                if (row.isLevel1) {
                    tr.className = "level-1-row";
                } else if (row.isLevel2) {
                    tr.className = "level-2-row";
                } else if (row.isLevel3) {
                    tr.className = "level-3-row";
                }

                // Highlight t·ª´ kh√≥a t√¨m ki·∫øm
                let displayName = row.name;
                if (keyword && matchKeyword) {
                    const regex = new RegExp(`(${keyword})`, 'gi');
                    displayName = displayName.replace(regex, '<span class="highlight">$1</span>');
                }

                tr.innerHTML = `
                    <td class="text-center">${row.c1}</td>
                    <td class="text-center fw-bold">${row.c2}</td>
                    <td class="text-center">${row.c3}</td>
                    <td class="text-center">${row.c4}</td>
                    <td class="text-center">${row.c5}</td>
                    <td>${displayName}</td>
                `;
                tbody.appendChild(tr);
                displayCount++;
            }
        });

        document.getElementById('recordCount').innerHTML = 
            `<strong>T√¨m th·∫•y ${displayCount}</strong> k·∫øt qu·∫£`;
        document.getElementById('displayCount').textContent = displayCount;
    }

    // ƒê·∫∑t l·∫°i b·ªô l·ªçc
    function resetFilter() {
        document.getElementById('level2Select').value = 'all';
        document.getElementById('searchInput').value = '';
        filterTable();
    }

    // Xu·∫•t CSV
    function exportToCSV() {
        let csv = 'C·∫•p 1,C·∫•p 2,C·∫•p 3,C·∫•p 4,C·∫•p 5,T√™n ngh·ªÅ nghi·ªáp\n';
        
        const rows = document.querySelectorAll('#tableBody tr');
        rows.forEach(row => {
            const cols = row.querySelectorAll('td');
            const rowData = Array.from(cols).map(col => {
                let text = col.textContent.trim();
                // Escape quotes
                text = text.replace(/"/g, '""');
                return `"${text}"`;
            });
            csv += rowData.join(',') + '\n';
        });

        // T·∫°o file download
        const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', 'danh_muc_nghe_nghiep.csv');
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
</script>

<!-- Bootstrap Icons (optional) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

</body>
</html>
